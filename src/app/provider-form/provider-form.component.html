<div class="form-container">
   
      <h1 mat-dialog-title>Configuration du Fournisseur LLM</h1>

    <mat-dialog-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="llm-form">
        
        <!-- Nom -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nom du fournisseur</mat-label>
          <input matInput formControlName="name" placeholder="ex: OpenAI">
          @if (form.get('name')?.hasError('required')) {
            <mat-error>Le nom est obligatoire</mat-error>
          }
        </mat-form-field>

        <!-- URL -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Chat URL</mat-label>
          <input matInput formControlName="chatUrl" placeholder="https://api.openai.com/v1">
          <mat-icon matSuffix>link</mat-icon>
          @if (form.get('chatUrl')?.invalid) {
            <mat-error>Veuillez saisir une URL valide</mat-error>
          }
        </mat-form-field>

        <!-- API Key -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Clé API</mat-label>
          <input matInput type="password" formControlName="apiKey">
          <mat-icon matSuffix>vpn_key</mat-icon>
        </mat-form-field>

        <mat-divider></mat-divider>

        <!-- Section Modèles avec @for -->
        <div class="models-container" formArrayName="models">
          <div class="header-row">
            <h3>Modèles disponibles</h3>
            <button type="button" mat-stroked-button color="primary" (click)="addModel()">
              <mat-icon>add</mat-icon> Ajouter
            </button>
          </div>

          @for (modelCtrl of models.controls; track $index) {
            <div class="model-row">
              <mat-form-field appearance="fill" class="model-input">
                <mat-label>Modèle #{{ $index + 1 }}</mat-label>
                <!-- On lie l'index au formControlName -->
                <input matInput [formControlName]="$index" placeholder="ex: gpt-4o">
              </mat-form-field>

              <button type="button" mat-icon-button color="warn" 
                      (click)="removeModel($index)" 
                      [disabled]="models.length <= 1">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          } @empty {
            <p>No model added.</p>
          }
        </div>

        <mat-dialog-actions align="end">
           <button mat-flat-button color="warn" type="button" mat-dialog-close >
            <mat-icon>close</mat-icon> Cancel
          </button>
          <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid">
            <mat-icon>save</mat-icon> Save
          </button>
        </mat-dialog-actions>

      </form>
    </mat-dialog-content>
</div>
